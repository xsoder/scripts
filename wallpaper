#!/usr/bin/env bash

WALLPAPER_DIR="/home/xsoder/wallpaper/penger"
STATE_FILE="/home/xsoder/.cache/current_wallpaper.txt"

mkdir -p "$(dirname "$STATE_FILE")"

if [ -f "$STATE_FILE" ]; then
    CURRENT_WALLPAPER=$(cat "$STATE_FILE")
    if [ -f "$CURRENT_WALLPAPER" ]; then
        feh --bg-fill "$CURRENT_WALLPAPER"
        exit 0
    fi
fi

mapfile -t WALLPAPERS < <(find "$WALLPAPER_DIR" -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \))
if [ ${#WALLPAPERS[@]} -eq 0 ]; then
    notify-send -t 5000 "Wallpaper Switcher" "No wallpapers found in $WALLPAPER_DIR"
    exit 1
fi

RANDOM_WALLPAPER="${WALLPAPERS[$RANDOM % ${#WALLPAPERS[@]}]}"

feh --bg-fill "$RANDOM_WALLPAPER"
echo "$RANDOM_WALLPAPER" > "$STATE_FILE"

notify-send -t 5000 "Wallpaper set to" "$RANDOM_WALLPAPER"
